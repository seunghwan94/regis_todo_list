{% extends "base.html" %}

{% block title %}ìƒˆ ì ê²€ ì¶”ê°€ - ì •ê¸° ì ê²€ ê´€ë¦¬{% endblock %}

{% block content %}
<h1><i class="bi bi-plus-circle me-3"></i>ìƒˆë¡œìš´ ì •ê¸° ì ê²€ ì¶”ê°€</h1>

<form method="post" enctype="multipart/form-data" action="/task/new">
    <!-- Company Selection -->
    <div class="card mb-4" style="border: 1px solid rgba(106, 134, 216, 0.15); background: linear-gradient(135deg, rgba(26,34,56,0.8) 0%, rgba(33,43,74,0.8) 100%); border-radius: 16px; padding: 1.5rem;">
        <h5 class="mb-3"><i class="bi bi-building me-2"></i>ê³ ê°ì‚¬ ì •ë³´</h5>
        <div class="mb-3">
            <label for="company_id" class="form-label">ê³ ê°ì‚¬ ì„ íƒ</label>
            <select class="form-select" id="company_id" name="company_id" required>
                <option value="" disabled selected>ê³ ê°ì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                {% for comp in companies %}
                    <option value="{{ comp['id'] }}">{{ comp['name'] }}{% if comp['sub_name'] %} / {{ comp['sub_name'] }}{% endif %}</option>
                {% endfor %}
            </select>
            <div class="form-text">
                <a href="/company/new" class="text-decoration-none">
                    <i class="bi bi-plus-circle me-1"></i>ìƒˆ ê³ ê°ì‚¬ ì¶”ê°€
                </a>
            </div>
        </div>
        <div class="mb-0">
            <label for="detail_name" class="form-label">ìƒì„¸ ê³ ê°ì‚¬</label>
            <input type="text" class="form-control" id="detail_name" name="detail_name" placeholder="ì˜ˆ: í™ˆí˜ì´ì§€ / ë‹¤ì´ë ‰íŠ¸ / mydata ë“±">
            <div class="form-text">ì •ê¸°ì ê²€ì´ ì§„í–‰ë˜ëŠ” ìƒì„¸ ì˜ì—­ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜µì…˜).</div>
        </div>
    </div>

    <!-- Task Type and Signature -->
    <div class="card mb-4" style="border: 1px solid rgba(106, 134, 216, 0.15); background: linear-gradient(135deg, rgba(26,34,56,0.8) 0%, rgba(33,43,74,0.8) 100%); border-radius: 16px; padding: 1.5rem;">
        <h5 class="mb-3"><i class="bi bi-clipboard-check me-2"></i>ì ê²€ ì •ë³´</h5>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">ì ê²€ ìœ í˜•</label>
                <div class="d-flex gap-3">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="task_type" id="type_in" value="INHOUSE" checked>
                        <label class="form-check-label" for="type_in" style="color: white;">
                            ğŸ¢ ì‚¬ë‚´ì ê²€
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="task_type" id="type_out" value="ONSITE">
                        <label class="form-check-label" for="type_out" style="color: white;">
                            ğŸš— ë°©ë¬¸ì ê²€
                        </label>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">ì„œëª… ë°©ë²•</label>
                <div class="d-flex gap-3">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="signature_method" id="sig_email" value="EMAIL" checked>
                        <label class="form-check-label" for="sig_email" style="color: white;">
                            ğŸ“§ ë©”ì¼
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="signature_method" id="sig_visit" value="VISIT">
                        <label class="form-check-label" for="sig_visit" style="color: white;">
                            âœï¸ ë°©ë¬¸
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Information -->
    <div class="card mb-4" style="border: 1px solid rgba(106, 134, 216, 0.15); background: linear-gradient(135deg, rgba(26,34,56,0.8) 0%, rgba(33,43,74,0.8) 100%); border-radius: 16px; padding: 1.5rem;">
        <h5 class="mb-3"><i class="bi bi-person-lines-fill me-2"></i>ë‹´ë‹¹ì ì •ë³´</h5>
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">ë‹´ë‹¹ì ì´ë¦„</label>
                <input type="text" class="form-control" name="contact_name" placeholder="í™ê¸¸ë™">
            </div>
            <div class="col-md-4">
                <label class="form-label">ì „í™”ë²ˆí˜¸</label>
                <input type="text" class="form-control" name="contact_phone" placeholder="010-1234-5678">
            </div>
            <div class="col-md-4">
                <label class="form-label">ì´ë©”ì¼</label>
                <input type="email" class="form-control" name="contact_email" placeholder="example@company.com">
            </div>
        </div>
    </div>

    <!-- Schedule -->
    <div class="card mb-4" style="border: 1px solid rgba(106, 134, 216, 0.15); background: linear-gradient(135deg, rgba(26,34,56,0.8) 0%, rgba(33,43,74,0.8) 100%); border-radius: 16px; padding: 1.5rem;">
        <h5 class="mb-3"><i class="bi bi-calendar-range me-2"></i>ìŠ¤ì¼€ì¤„ ì„¤ì •</h5>
        <div class="mb-3">
            <label for="schedule_type" class="form-label">ìŠ¤ì¼€ì¤„ ìœ í˜•</label>
            <select class="form-select" id="schedule_type" name="schedule_type" required onchange="onScheduleTypeChange()">
                <option value="monthly" selected>ë§¤ì›”</option>
                <option value="quarterly">ë¶„ê¸°</option>
                <option value="custom">ê¸°íƒ€ (ì‚¬ìš©ì ì§€ì •)</option>
            </select>
            <div id="scheduleDetailHelp" class="form-text"></div>
        </div>
        <div class="mb-0" id="schedule_detail_wrapper" style="display: none;">
            <label for="schedule_detail" class="form-label">ìŠ¤ì¼€ì¤„ ìƒì„¸ (ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ì›”)</label>
            <input type="text" class="form-control" id="schedule_detail" name="schedule_detail" placeholder="ì˜ˆ: 1,4,7,10">
            <div class="form-text">ë¶„ê¸°ë‚˜ ê¸°íƒ€ ìœ í˜•ì¼ ê²½ìš° ìˆ˜í–‰í•  ì›”ë“¤ì„ ì‰¼í‘œë¡œ ì…ë ¥í•˜ì„¸ìš”.</div>
        </div>
    </div>

    <!-- Checklist Items -->
    <div class="card mb-4" style="border: 1px solid rgba(106, 134, 216, 0.15); background: linear-gradient(135deg, rgba(26,34,56,0.8) 0%, rgba(33,43,74,0.8) 100%); border-radius: 16px; padding: 1.5rem;">
        <h5 class="mb-3"><i class="bi bi-list-check me-2"></i>ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª©</h5>
        <p class="text-muted mb-3">ê° í•­ëª©ì— ëŒ€í•œ ì„¤ëª…ê³¼ (ì„ íƒ ì‚¬í•­) ì²¨ë¶€íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”. ë¹ˆ í•­ëª©ì€ ë¬´ì‹œë©ë‹ˆë‹¤.</p>
        <div id="items-container">
            <div class="row g-2 mb-2 checklist-item p-3" style="background: rgba(26,34,56,0.8); border-radius: 12px; border: 1px solid rgba(106,134,216,0.15); color: #c7cbe1;">
                <div class="col-md-8">
                    <label class="form-label">í•­ëª© ì„¤ëª…</label>
                    <input type="text" class="form-control" name="item_description" placeholder="ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">ì²¨ë¶€íŒŒì¼ (ì„ íƒ)</label>
                    <input type="file" class="form-control" name="item_file">
                </div>
            </div>
        </div>
        <button type="button" class="btn btn-outline-secondary" onclick="addChecklistItem()">
            <i class="bi bi-plus-circle me-2"></i>í•­ëª© ì¶”ê°€
        </button>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-check-circle me-2"></i>ì €ì¥
        </button>
        <a href="/" class="btn btn-secondary btn-lg">
            <i class="bi bi-x-circle me-2"></i>ì·¨ì†Œ
        </a>
    </div>
</form>

{% endblock %}

{% block scripts %}
<script>
    function onScheduleTypeChange() {
        const typeSelect = document.getElementById('schedule_type');
        const detailWrapper = document.getElementById('schedule_detail_wrapper');
        const help = document.getElementById('scheduleDetailHelp');
        if (typeSelect.value === 'monthly') {
            detailWrapper.style.display = 'none';
            help.innerHTML = '<i class="bi bi-info-circle me-2"></i>ë§¤ì›” ì •ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤.';
        } else if (typeSelect.value === 'quarterly') {
            detailWrapper.style.display = 'block';
            help.innerHTML = '<i class="bi bi-info-circle me-2"></i>ì˜ˆ: 1,4,7,10 ë˜ëŠ” 3,6,9,12 ë“± ë¶„ê¸° ì‹œì‘ ì›”ì„ ì‰¼í‘œë¡œ ì…ë ¥í•˜ì„¸ìš”.';
        } else {
            detailWrapper.style.display = 'block';
            help.innerHTML = '<i class="bi bi-info-circle me-2"></i>ìˆ˜í–‰í•  ì›”ë“¤ì„ ì‰¼í‘œë¡œ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 2,5,8,11).';
        }
    }
    
    function addChecklistItem() {
        const container = document.getElementById('items-container');
        const row = document.createElement('div');
        row.className = 'row g-2 mb-2 checklist-item p-3';
        row.style.cssText = 'background: rgba(26,34,56,0.8); border-radius: 12px; border: 1px solid rgba(106,134,216,0.15); color: #c7cbe1;';
        row.innerHTML = `
            <div class="col-md-8">
                <label class="form-label">í•­ëª© ì„¤ëª…</label>
                <input type="text" class="form-control" name="item_description" placeholder="ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="col-md-4">
                <label class="form-label">ì²¨ë¶€íŒŒì¼ (ì„ íƒ)</label>
                <input type="file" class="form-control" name="item_file">
            </div>
        `;
        container.appendChild(row);
    }
    
    document.addEventListener('DOMContentLoaded', onScheduleTypeChange);
</script>
{% endblock %}